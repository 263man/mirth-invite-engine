<?xml version="1.0" encoding="UTF-8"?>
<channel version="4.5.2">
  <id></id>
  <nextMetaDataId>2</nextMetaDataId>
  <name>HL7 ADT to JSON API</name>
  <description>Receives HL7 v2 ADT via TCP, transforms to JSON, sends to .NET API.</description>
  <revision>1</revision>
  <lastModified>2025-09-18 00:00:00.000</lastModified>
  <enabled>true</enabled>
  <sourceConnector version="4.5.2">
    <metaDataId>0</metaDataId>
    <name>sourceConnector</name>
    <properties class="com.mirth.connect.connectors.tcp.TcpReceiverProperties" version="4.5.2">
      <listenerSettings>
        <host>0.0.0.0</host>
        <port>6661</port>
      </listenerSettings>
      <transmissionModeProperties class="com.mirth.connect.plugins.mllp.MllpTransmissionModeProperties">
        <startOfMessageBytes>0B</startOfMessageBytes>
        <endOfMessageBytes>1C0D</endOfMessageBytes>
      </transmissionModeProperties>
      <serverMode>true</serverMode>
    </properties>
    <transformer version="4.5.2">
      <steps/>
      <inboundDataType>HL7V2</inboundDataType>
      <outboundDataType>HL7V2</outboundDataType>
    </transformer>
    <filter version="4.5.2">
      <rules/>
    </filter>
    <transportName>TCP Listener</transportName>
    <mode>SOURCE</mode>
    <enabled>true</enabled>
  </sourceConnector>
  <destinationConnectors>
    <connector version="4.5.2">
      <metaDataId>1</metaDataId>
      <name>HTTP Destination</name>
      <properties class="com.mirth.connect.connectors.http.HttpDispatcherProperties" version="4.5.2">
        <host>http://mirth-invite-engine-api:8080/api/patient</host>
        <method>POST</method>
        <headers class="linked-hash-map">
          <entry>
            <string>Content-Type</string>
            <string>application/json</string>
          </entry>
        </headers>
        <content>${tmp}</content>
        <contentType>application/json</contentType>
      </properties>
      <transformer version="4.5.2">
        <steps>
          <step>
            <sequenceNumber>0</sequenceNumber>
            <name>Transform to JSON</name>
            <script><![CDATA[
              var patientJson = {
                patientID: msg['PID']['PID.3']['PID.3.1'].toString(),
                firstName: msg['PID']['PID.5']['PID.5.2'].toString(),
                lastName: msg['PID']['PID.5']['PID.5.1'].toString(),
                dateOfBirth: msg['PID']['PID.7']['PID.7.1'].toString()
              };
              tmp = JSON.stringify(patientJson);
            ]]></script>
            <type>JavaScript</type>
          </step>
        </steps>
        <inboundDataType>HL7V2</inboundDataType>
        <outboundDataType>TEXT</outboundDataType>
      </transformer>
      <filter version="4.5.2">
        <rules/>
      </filter>
      <transportName>HTTP Sender</transportName>
      <mode>DESTINATION</mode>
      <enabled>true</enabled>
    </connector>
  </destinationConnectors>
  <preprocessingScript/>
  <postprocessingScript/>
  <deployScript/>
  <undeployScript/>
</channel>